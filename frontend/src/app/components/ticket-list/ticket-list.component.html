<app-header></app-header>
<app-weather-banner></app-weather-banner>
<div class="ticket-list-container">
  <header class="header">
    <h1>Ticket Management</h1>
    <button class="btn btn-primary" (click)="toggleForm()">
      {{ showForm() ? 'Cancel' : 'Create New Ticket' }}
    </button>
  </header>

  <!-- Error message -->
  <div class="error" *ngIf="ticketService.error()">
    <p>‚ùå {{ ticketService.error() }}</p>
  </div>

  <!-- Create form -->
  <app-ticket-form
    *ngIf="showForm()"
    (close)="onFormClose()">
  </app-ticket-form>

  <!-- Filters -->
  <div class="filters-container">
    <!-- Status Filter -->
    <div class="filter-section">
      <h3>Status</h3>
      <div class="filters">
        <button
          class="filter-btn"
          [class.active]="filterStatus() === null"
          (click)="setStatusFilter(null)">
          All
        </button>
        <button
          class="filter-btn"
          [class.active]="filterStatus() === StatusEnum.OPEN"
          (click)="setStatusFilter(StatusEnum.OPEN)">
          Open
        </button>
        <button
          class="filter-btn"
          [class.active]="filterStatus() === StatusEnum.IN_PROGRESS"
          (click)="setStatusFilter(StatusEnum.IN_PROGRESS)">
          In Progress
        </button>
        <button
          class="filter-btn"
          [class.active]="filterStatus() === StatusEnum.CLOSED"
          (click)="setStatusFilter(StatusEnum.CLOSED)">
          Closed
        </button>
      </div>
    </div>

    <!-- Priority Filter -->
    <div class="filter-section">
      <h3>Priority</h3>
      <div class="filters">
        <button
          class="filter-btn"
          [class.active]="filterPriority() === null"
          (click)="setPriorityFilter(null)">
          All
        </button>
        <button
          class="filter-btn"
          [class.active]="filterPriority() === PriorityEnum.LOW"
          (click)="setPriorityFilter(PriorityEnum.LOW)">
          Low
        </button>
        <button
          class="filter-btn"
          [class.active]="filterPriority() === PriorityEnum.MEDIUM"
          (click)="setPriorityFilter(PriorityEnum.MEDIUM)">
          Medium
        </button>
        <button
          class="filter-btn"
          [class.active]="filterPriority() === PriorityEnum.HIGH"
          (click)="setPriorityFilter(PriorityEnum.HIGH)">
          High
        </button>
        <button
          class="filter-btn"
          [class.active]="filterPriority() === PriorityEnum.CRITICAL"
          (click)="setPriorityFilter(PriorityEnum.CRITICAL)">
          Critical
        </button>
      </div>
    </div>

    <!-- Assignee Filter -->
    <div class="filter-section">
      <h3>Assignee</h3>
      <div class="filters">
        <button
          class="filter-btn"
          [class.active]="filterAssignee() === null"
          (click)="setAssigneeFilter(null)">
          All
        </button>
        <button
          class="filter-btn"
          *ngFor="let user of availableUsers()"
          [class.active]="filterAssignee() === user.id"
          (click)="setAssigneeFilter(user.id)">
          {{ user.name }}
        </button>
      </div>
    </div>

    <!-- Tags Filter (Text Input) -->
    <div class="filter-section">
      <h3>Tags</h3>
      <div class="tags-input-container">
        <input
          type="text"
          class="tags-input"
          placeholder="Enter tags separated by commas (e.g., bug, ui, feature)"
          [(ngModel)]="filterTags"
          (input)="onTagsInput()"
        />
        <div class="tags-hint" *ngIf="availableTags().length > 0">
          <span class="hint-label">Available tags:</span>
          <span class="hint-tags">{{ availableTags().join(', ') }}</span>
        </div>
      </div>
    </div>

    <!-- Clear Filters Button -->
    <button
      class="btn btn-secondary clear-filters-btn"
      *ngIf="hasActiveFilters()"
      (click)="clearFilters()">
      üîÑ Clear All Filters
    </button>
  </div>

  <!-- Loading state -->
  <div class="loading" *ngIf="ticketService.loading()">
    <div class="spinner"></div>
    <p>Loading tickets...</p>
  </div>

  <!-- Tickets list -->
  <div class="tickets-grid" *ngIf="!ticketService.loading()">
    <app-ticket-item
      *ngFor="let ticket of tickets"
      [ticket]="ticket">
    </app-ticket-item>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!ticketService.loading() && tickets.length === 0">
    <p>üì≠ No tickets found</p>
    <p class="empty-hint" *ngIf="hasActiveFilters()">Try adjusting your filters</p>
  </div>
</div>
