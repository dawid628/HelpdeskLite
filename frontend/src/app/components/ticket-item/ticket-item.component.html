<div class="ticket-card">
  <div class="ticket-header">
    <h3 class="ticket-title">{{ ticket.title }}</h3>
    <div class="header-actions">
      <app-priority-badge
        [priority]="ticket.priority"
        size="medium">
      </app-priority-badge>
      <button
        class="delete-btn"
        *ngIf="canDeleteTicket()"
        (click)="deleteTicket()"
        title="Delete ticket">Ã—</button>
    </div>
  </div>

  <p class="ticket-description">{{ ticket.description }}</p>

  <div class="ticket-meta">
    <div class="meta-item">
      <span class="meta-label">ğŸ‘¤ Assignee:</span>
      <span class="meta-value">{{ ticket.assignee?.name || 'Unassigned' }}</span>
    </div>
    <div class="meta-item">
      <span class="meta-label">ğŸ“ Reporter:</span>
      <span class="meta-value">{{ ticket.reporter?.name || 'Unknown' }}</span>
    </div>
  </div>

  <div class="ticket-tags" *ngIf="ticket.tags && ticket.tags.length > 0">
    <span class="tag" *ngFor="let tag of ticket.tags">#{{ tag }}</span>
  </div>

  <app-triage-panel
    *ngIf="showTriage"
    [suggestedPriority]="triageSuggestion?.suggested_priority || null"
    [suggestedStatus]="triageSuggestion?.suggested_status || null"
    [suggestedTags]="triageSuggestion?.suggested_tags || []"
    [reasoning]="triageSuggestion?.reasoning || ''"
    [loading]="triageLoading || applyingTriage"
    [error]="triageError"
    (accept)="acceptTriage(triageSuggestion!)"
    (reject)="rejectTriage()"
    (close)="closeTriage()">
  </app-triage-panel>

  <div class="ticket-footer">
    <div class="status-section">
      <span class="status-label">Status:</span>
      <select
        class="status-select"
        [(ngModel)]="currentStatus"
        (ngModelChange)="onStatusChange()"
        [style.background-color]="getStatusColor(currentStatus)"
        [disabled]="!canUpdateTicket()">
        <option [ngValue]="StatusEnum.OPEN">{{ getStatusLabel(StatusEnum.OPEN) }}</option>
        <option [ngValue]="StatusEnum.IN_PROGRESS">{{ getStatusLabel(StatusEnum.IN_PROGRESS) }}</option>
        <option [ngValue]="StatusEnum.CLOSED">{{ getStatusLabel(StatusEnum.CLOSED) }}</option>
      </select>
    </div>
    <span class="ticket-date">ğŸ“… {{ ticket.created_at | date:'short' }}</span>
  </div>

  <div class="ticket-actions">
    <button
      class="btn btn-triage"
      *ngIf="canUseTriage() && !showTriage"
      (click)="requestTriage()">
      Suggest Triage
    </button>
  </div>

  <div class="permission-info" *ngIf="!canUpdateTicket()">
    <small>ğŸ‘ï¸ View only</small>
  </div>
</div>
